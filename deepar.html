<!DOCTYPE html>
<html>
  <head>
    <title>DeepAR from a CDN</title>
    <!-- Load deepar.js -->
    <script src="https://cdn.jsdelivr.net/npm/deepar/js/deepar.js"></script>
  </head>

  <body style="height: 100vh; width: 100vw; margin: 0; overflow: hidden">
    <!-- Canvas element for AR preview -->
    <div>
      <button id="backwardBtn">Backward</button>
      <input placeholder="Enter the Product name" id="productName" />
      <button id="forwardBtn">Forward</button>
    </div>
    <canvas
      style="max-width: 100%; max-height: 100%; width: 100%; height: 100%"
      id="deepar-canvas"
    ></canvas>
    <!-- Buttons to start and stop the prediction engine -->

    <!-- Initialize DeepAR and load AR effect/filter -->
    <script>
      let effects = [
        {
          id: "1",
          effect: "https://cdn.jsdelivr.net/npm/deepar/effects/aviators",
          product_name: "a",
        },
        {
          id: "2",
          effect: "./effects/sunglas.deepar",
          product_name: "b",
        },
        {
          id: "3",
          effect: "./effects/Red-Glass-Frame-with-Black-Metal.deepar",
          product_name: "c",
        },
        {
          id: "4",
          effect: "./effects/handleless-Red-Glass.deepar",
          product_name: "d",
        },
      ];
      var currentIndex = 0;
      var deepAR;

      const forwardBtn = document.getElementById("forwardBtn");
      const productName = document.getElementById("productName");
      const backwardBtn = document.getElementById("backwardBtn");
      productName.addEventListener("change", (e) => {
        const searchTerm = e.target.value.toLowerCase();
        const filteredIndex = effects.findIndex(
          (effect) => effect.product_name.toLowerCase() === searchTerm
        );
        if (filteredIndex !== -1) {
          currentIndex = filteredIndex;
          updateValues(currentIndex);
          console.log("Index for Product Name:", currentIndex);
        } else {
          console.log("Product not found.");
        }
      });

      forwardBtn.addEventListener("click", () => {
        if (currentIndex < effects.length - 1) {
          currentIndex = currentIndex + 1;
          updateValues(currentIndex);
          console.log("Forward Index:", currentIndex);
        } else {
          currentIndex = 0;
          updateValues(currentIndex);
          console.log("Forward Index:", currentIndex);
        }
        // You can perform actions here based on the currentIndex
      });

      backwardBtn.addEventListener("click", () => {
        if (currentIndex > 0) {
          currentIndex = currentIndex - 1;
          updateValues(currentIndex);
          console.log("Backward Index:", currentIndex);
        } else {
          currentIndex = effects.length - 1;
        }
        // You can perform actions here based on the currentIndex
      });

      // Switch filter 1.

      // Remove the current filter.

      async function updateValues(currentIndex) {
        await deepAR.switchEffect(effects[currentIndex].effect);
      }
      (async function () {
        const canvas = document.getElementById("deepar-canvas");
        const dpr = window.devicePixelRatio || 1;
        canvas.width = Math.floor(canvas.clientWidth * dpr);
        canvas.height = Math.floor(canvas.clientHeight * dpr);
        console.log(effects);
        deepAR = await deepar.initialize({
          licenseKey:
            "ce036f51766b00e5e92d6ce685e652ed9aba1f244cc9a500294f72f366f929a637eefa7fc2effa6a",
          canvas: document.getElementById("deepar-canvas"),
          effect: effects[0].effect,
        });
      })();
      console.log("effects current index", effects[currentIndex]);
    </script>
  </body>
</html>
